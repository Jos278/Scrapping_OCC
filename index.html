<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Encuentra empleo</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />
  <!-- Asegúrate de tener el CSS -->
</head>

<body class="min-h-screen">
  <div class="flex flex-col items-center justify-center min-h-screen px-4">
    <div class="w-full max-w-3xl rounded-lg p-8">
      <!-- Título actualizado -->
      <h1 class="mb-8 text-2xl md:text-4xl font-bold text-white text-center">
        Encuentra tu trabajo soñado aquí ✨
      </h1>

      <!-- Barra de búsqueda -->
      <form id="searchForm" class="flex flex-col sm:flex-row gap-4 mb-6">
        <input type="text" id="searchInput" placeholder="Ingresa el puesto que buscas..." required
          class="flex-1 px-4 py-3 text-lg border border-white/30 text-white placeholder-white placeholder-opacity-70 rounded-full bg-white/20 backdrop-blur focus:outline-none" />
        <button type="submit" id="searchBtn"
          class="cursor-pointer transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed"></button>
      </form>

      <!-- Spinner y mensajes -->
      <div id="status" class="mt-6 text-lg text-white text-center flex flex-col items-center gap-4"></div>

      <!-- Botón -->
      <button id="verVacantesBtn" onclick="window.location='resultadosVacantes.html'"
        class="hidden mt-8 px-8 py-3 text-white font-bold rounded-full transition-colors">
        Vacantes encontradas 🧩
      </button>

      <div id="downloadButtons" class="hidden mt-4 flex flex-wrap gap-4 justify-center sm:justify-end">
        <button id="downloadCsvBtn"
          class="px-8 py-3 text-white font-bold rounded-full transition-colors flex items-center gap-2 estilo-boton-vacantes">
          <i class="bi bi-filetype-csv text-xl"></i>
          CSV
        </button>

        <button id="downloadExcelBtn"
          class="px-8 py-3 text-white font-bold rounded-full transition-colors flex items-center gap-2 estilo-boton-vacantes">
          <i class="bi bi-filetype-xlsx text-xl"></i>
          Excel
        </button>

        <button id="downloadJsonBtn"
          class="px-8 py-3 text-white font-bold rounded-full transition-colors flex items-center gap-2 estilo-boton-vacantes">
          <i class="bi bi-filetype-json text-xl"></i>
          JSON
        </button>
      </div>


      <!-- Botón de cancelar búsqueda -->
      <button id="cancelarBusquedaBtn"
        class="hidden mt-4 px-6 py-2 text-sm text-white bg-red-600 hover:bg-red-700 rounded-full font-semibold transition-colors">
        Cancelar búsqueda ✖️
      </button>
    </div>
  </div>

  <footer>
    <div class="parrafo">
      <p>Datos Obtenidos Solo Con Fines Educativos.</p>
    </div>
  </footer>

  <!-- JS -->
  <script>

    const downloadButtons = document.getElementById("downloadButtons");
    const searchForm = document.getElementById("searchForm");

    const searchInput = document.getElementById("searchInput");
    const searchBtn = document.getElementById("searchBtn");
    const status = document.getElementById("status");
    const verVacantesBtn = document.getElementById("verVacantesBtn");

    const frases = [
      "Estamos buscando las mejores ofertas, espera un momento 🙌",
      "Consejo: Asegúrate de tener actualizado tu CV 📄",
      "Recuerda usar palabras clave específicas para mejores resultados 🔍",
      "Elige vacantes que coincidan con tus habilidades 💼",
      "Postúlate con confianza, tú puedes 💪",
      "La perseverancia es clave en la búsqueda de empleo 🎯",
    ];

    let fraseIndex = 0;
    let fraseInterval;

    function mostrarFrases() {
      fraseIndex = 0;

      // Estructura separada: spinner y frase
      status.innerHTML = `
        <span class="loaderr"></span>
        <div id="frase" class="fade-message"><i>${frases[fraseIndex]}</i></div>
      `;

      fraseInterval = setInterval(() => {
        fraseIndex++;
        if (fraseIndex >= frases.length) {
          clearInterval(fraseInterval);
          return;
        }

        const fraseDiv = document.getElementById("frase");
        fraseDiv.classList.remove("fade-message");
        void fraseDiv.offsetWidth;
        fraseDiv.textContent = frases[fraseIndex];
        fraseDiv.classList.add("fade-message");
      }, 3000);
    }

    searchForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const searchTerm = searchInput.value.trim();

      if (!searchTerm) {
        status.textContent = "Por favor ingresa un término de búsqueda";
        return;
      }

      status.innerHTML = "";
      searchBtn.disabled = true;
      verVacantesBtn.classList.add("hidden");

      mostrarFrases();

      try {
        const response = await fetch("/search", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ searchTerm }),
        });

        const data = await response.json();
        clearInterval(fraseInterval);

        if (data.success) {
          status.innerHTML = `<div class="fade-message">${data.message}</div>`;
          verVacantesBtn.classList.remove("hidden");
          downloadButtons.classList.remove("hidden");

        } else {
          status.innerHTML = `<div class="fade-message">${data.error || "Error al buscar vacantes"
            }</div>`;
        }
      } catch (error) {
        clearInterval(fraseInterval);
        status.innerHTML = `<div class="fade-message">¡Oh no! Parece que no hay conexión, verifica que estés conectado.</div>`;
      } finally {
        searchBtn.disabled = false;
      }
    });

    document.getElementById("downloadCsvBtn").addEventListener("click", () => {
      window.location.href = 'resultados.csv';
    });

    document.getElementById("downloadExcelBtn").addEventListener("click", () => {
      window.location.href = 'resultados.xlsx';
    });

    document.getElementById("downloadJsonBtn").addEventListener("click", () => {
      const link = document.createElement("a");
      link.href = 'resultados.json';
      link.download = 'resultados.json';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    });

  </script>
</body>

</html>